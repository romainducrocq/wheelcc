cmake_minimum_required(VERSION 3.5)

file(READ "../bin/package_name.txt" PACKAGE_NAME)
project("${PACKAGE_NAME}")

set(CMAKE_CXX_FLAGS "-Wall -Wextra -Wpedantic")
if("cxx_std_20" IN_LIST CMAKE_CXX_COMPILE_FEATURES)
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++20")
else("cxx_std_20" IN_LIST CMAKE_CXX_COMPILE_FEATURES)
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++17")
endif()
if(__NDEBUG__)
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Werror -D__NDEBUG__")
endif(__NDEBUG__)
set(CMAKE_CXX_FLAGS_DEBUG "-ggdb3 -O0")
set(CMAKE_CXX_FLAGS_RELEASE "-O3 -DNDEBUG")

set(SOURCE_DIR "${PROJECT_SOURCE_DIR}/../src/")
set(HEADER_DIR "${PROJECT_SOURCE_DIR}/../include/" "${SOURCE_DIR}/frontend/parser/")
set(LIB_DIR "${PROJECT_SOURCE_DIR}/../lib/")
set(BIN_DIR "${PROJECT_SOURCE_DIR}/../bin/")
# file(GLOB_RECURSE SOURCE_FILES "${SOURCE_DIR}/*.cpp")

list(APPEND SOURCE_FILES "${SOURCE_DIR}/util/throw.cpp")
list(APPEND SOURCE_FILES "${SOURCE_DIR}/util/str2t.cpp")
# list(APPEND SOURCE_FILES "${SOURCE_DIR}/util/pprint.cpp")
list(APPEND SOURCE_FILES "${SOURCE_DIR}/util/util.cpp")
list(APPEND SOURCE_FILES "${SOURCE_DIR}/util/fileio.cpp")
# list(APPEND SOURCE_FILES "${SOURCE_DIR}/backend/emitter/gas_code.cpp")
# list(APPEND SOURCE_FILES "${SOURCE_DIR}/backend/assembly/registers.cpp")
# list(APPEND SOURCE_FILES "${SOURCE_DIR}/backend/assembly/asm_gen.cpp")
# list(APPEND SOURCE_FILES "${SOURCE_DIR}/backend/assembly/stack_fix.cpp")
# list(APPEND SOURCE_FILES "${SOURCE_DIR}/backend/assembly/symt_cvt.cpp")
# list(APPEND SOURCE_FILES "${SOURCE_DIR}/optimization/reg_alloc.cpp")
# list(APPEND SOURCE_FILES "${SOURCE_DIR}/optimization/optim_tac.cpp")
# list(APPEND SOURCE_FILES "${SOURCE_DIR}/frontend/intermediate/tac_repr.cpp")
# list(APPEND SOURCE_FILES "${SOURCE_DIR}/frontend/intermediate/names.cpp")
# list(APPEND SOURCE_FILES "${SOURCE_DIR}/frontend/intermediate/semantic.cpp")
list(APPEND SOURCE_FILES "${SOURCE_DIR}/frontend/parser/errors.cpp")
# list(APPEND SOURCE_FILES "${SOURCE_DIR}/frontend/parser/parser.cpp")
# list(APPEND SOURCE_FILES "${SOURCE_DIR}/frontend/parser/lexer.cpp")
list(APPEND SOURCE_FILES "${SOURCE_DIR}/ast/front_ast.cpp")
list(APPEND SOURCE_FILES "${SOURCE_DIR}/ast/interm_ast.cpp")
list(APPEND SOURCE_FILES "${SOURCE_DIR}/ast/back_ast.cpp")
list(APPEND SOURCE_FILES "${SOURCE_DIR}/ast/back_symt.cpp")
list(APPEND SOURCE_FILES "${SOURCE_DIR}/ast/front_symt.cpp")
list(APPEND SOURCE_FILES "${SOURCE_DIR}/ast/ast.cpp")
list(APPEND SOURCE_FILES "${SOURCE_DIR}/main.cpp")

add_executable(${PROJECT_NAME} ${SOURCE_FILES})
target_include_directories(${PROJECT_NAME} PRIVATE ${HEADER_DIR} ${LIB_DIR})
set_target_properties(${PROJECT_NAME} PROPERTIES RUNTIME_OUTPUT_DIRECTORY ${BIN_DIR})
