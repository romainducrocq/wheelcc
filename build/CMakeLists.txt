cmake_minimum_required(VERSION 3.5)

file(READ "../bin/package_name.txt" PACKAGE_NAME)
project("${PACKAGE_NAME}")

set(PROJECT_DIR "${PROJECT_SOURCE_DIR}/..")

set(CMAKE_CXX_FLAGS "-std=c++17 -Wall -Wextra -Wpedantic")
if(__NDEBUG__)
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Werror -pedantic-errors -D__NDEBUG__")
endif(__NDEBUG__)
set(CMAKE_CXX_FLAGS_DEBUG "-ggdb3 -O0")
set(CMAKE_CXX_FLAGS_RELEASE "-O3 -DNDEBUG")

set(OUTPUT_DIR "${PROJECT_DIR}/bin/")

list(APPEND INCLUDE_DIRS "${PROJECT_DIR}/include/")
list(APPEND INCLUDE_DIRS "${PROJECT_DIR}/src/ast/")
list(APPEND INCLUDE_DIRS "${PROJECT_DIR}/src/optimization/")
list(APPEND INCLUDE_DIRS "${PROJECT_DIR}/src/frontend/")
list(APPEND INCLUDE_DIRS "${PROJECT_DIR}/src/backend/")
list(APPEND INCLUDE_DIRS "${PROJECT_DIR}/src/frontend/")
list(APPEND INCLUDE_DIRS "${PROJECT_DIR}/lib/")

list(APPEND SOURCE_FILES "${PROJECT_DIR}/src/main.cpp")
list(APPEND SOURCE_FILES "${PROJECT_DIR}/src/ast/ast.c")
list(APPEND SOURCE_FILES "${PROJECT_DIR}/src/ast/back_ast.c")
list(APPEND SOURCE_FILES "${PROJECT_DIR}/src/ast/back_symt.c")
list(APPEND SOURCE_FILES "${PROJECT_DIR}/src/ast/front_ast.c")
list(APPEND SOURCE_FILES "${PROJECT_DIR}/src/ast/front_symt.c")
list(APPEND SOURCE_FILES "${PROJECT_DIR}/src/ast/interm_ast.c")
# list(APPEND SOURCE_FILES "${PROJECT_DIR}/src/optimization/optim_tac.cpp")
# list(APPEND SOURCE_FILES "${PROJECT_DIR}/src/optimization/reg_alloc.cpp")
list(APPEND SOURCE_FILES "${PROJECT_DIR}/src/frontend/parser/errors.c")
list(APPEND SOURCE_FILES "${PROJECT_DIR}/src/frontend/parser/lexer.c")
list(APPEND SOURCE_FILES "${PROJECT_DIR}/src/frontend/parser/parser.c")
list(APPEND SOURCE_FILES "${PROJECT_DIR}/src/frontend/intermediate/idents.c")
list(APPEND SOURCE_FILES "${PROJECT_DIR}/src/frontend/intermediate/semantic.c")
list(APPEND SOURCE_FILES "${PROJECT_DIR}/src/frontend/intermediate/tac_repr.c")
list(APPEND SOURCE_FILES "${PROJECT_DIR}/src/backend/assembly/asm_gen.c")
list(APPEND SOURCE_FILES "${PROJECT_DIR}/src/backend/assembly/registers.c")
list(APPEND SOURCE_FILES "${PROJECT_DIR}/src/backend/assembly/stack_fix.c")
list(APPEND SOURCE_FILES "${PROJECT_DIR}/src/backend/assembly/symt_cvt.c")
# list(APPEND SOURCE_FILES "${PROJECT_DIR}/src/backend/emitter/gas_code.cpp")
list(APPEND SOURCE_FILES "${PROJECT_DIR}/src/util/fileio.c")
list(APPEND SOURCE_FILES "${PROJECT_DIR}/src/util/pprint.c")
list(APPEND SOURCE_FILES "${PROJECT_DIR}/src/util/str2t.c")
list(APPEND SOURCE_FILES "${PROJECT_DIR}/src/util/throw.c")
list(APPEND SOURCE_FILES "${PROJECT_DIR}/lib/sds/sds.c")
list(APPEND SOURCE_FILES "${PROJECT_DIR}/lib/stb_ds/stb_ds.c")

add_executable(${PROJECT_NAME} ${SOURCE_FILES})
target_include_directories(${PROJECT_NAME} PRIVATE ${INCLUDE_DIRS})
set_target_properties(${PROJECT_NAME} PROPERTIES RUNTIME_OUTPUT_DIRECTORY ${OUTPUT_DIR})
